// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model ProjectComment {
  id        String   @id @default(uuid())
  createdAt DateTime @default(now())

  comment   String // text of comment
  projectId String // commented project
  author    String // id of author
  upvotedBy String[] // ids of users

  @@map(name: "project_comments")
}

model CollaborationComment {
  id        String   @id @default(uuid())
  createdAt DateTime @default(now())

  comment    String // text of comment
  projectId  String // commented project
  questionId String // commented question
  author     String // id of author
  upvotedBy  String[] // ids of users
  visible    Boolean                        @default(true) // visibility of the comment (default: true) only used for the platform feedback (can only be false on the platform feedback)
  responses  CollaborationCommentResponse[] @relation("Response") // responses to the comment

  @@map(name: "collaboration_comments")
}

model CollaborationCommentResponse {
  id        String   @id @default(uuid())
  createdAt DateTime @default(now())

  response    String // text of response
  author      String // id of the author
  upvotedBy   String[] // ids of users
  commentId   String // id of comment this responds to to
  comment     CollaborationComment @relation("Response", fields: [commentId], references: [id], onDelete: Cascade) // comment this responds to

  @@map("collaboration_comments_responses")
}

model Like {
  id        String   @id @default(uuid())
  createdAt DateTime @default(now())

  projectId String // liked project
  likedBy   String // user id  
}

model Follow {
  id        String   @id @default(uuid())
  createdAt DateTime @default(now())

  projectId  String // followed project
  followedBy String // user id  
}

model PushSubscription {
  id        String   @id @default(uuid())
  userId    String
  createdAt DateTime @default(now())

  subscription String
}

model Reaction {
  id        String   @id @default(uuid())
  createdAt DateTime @default(now())

  reactedBy  String // user id
  objectId   String // object id that was reacted to (e.g. id of update or event)
  objectType ReactionObjectType // type of object that was reacted to (e.g. update or event)

  shortCode    String // shortcode of emoji, see unicode
  nativeSymbol String // native representation of emoji symbol, see unicode

  @@unique(fields: [reactedBy, objectId, objectType])
  @@map("reactions")
}

model SurveyVote {
  id        String   @id @default(uuid())
  createdAt DateTime @default(now())

  vote             String // vote
  projectId        String // project
  surveyQuestionId String // voted survey question
  votedBy          String // id of author

  @@map(name: "survey_votes")
}

enum ReactionObjectType {
  UPDATE
  EVENT
}